<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presentation Editor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.secondary {
            background-color: #95a5a6;
        }
        button.secondary:hover {
            background-color: #7f8c8d;
        }
        button.danger {
            background-color: #e74c3c;
        }
        button.danger:hover {
            background-color: #c0392b;
        }
        .slide-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .slide {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background-color: white;
            position: relative;
        }
        .slide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .slide-title {
            font-weight: bold;
            font-size: 18px;
        }
        .slide-controls {
            display: flex;
            gap: 8px;
        }
        .slide-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .slide-content {
                grid-template-columns: 1fr;
            }
        }
        .media-section, .details-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .media-preview {
            border: 1px dashed #ccc;
            border-radius: 4px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f9f9f9;
            overflow: hidden;
        }
        .media-preview img, .media-preview video {
            max-width: 100%;
            max-height: 300px;
            display: block;
        }
        .media-upload {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-weight: 500;
            font-size: 14px;
        }
        input[type="text"], input[type="file"], textarea, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .pointer-path-editor {
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .path-points {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        .path-point {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .path-point input {
            width: 60px;
        }
        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .export-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        .export-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .hidden {
            display: none;
        }
        .drag-handle {
            cursor: move;
            padding: 5px;
            color: #7f8c8d;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Presentation Editor</h1>
        
        <div class="toolbar">
            <button id="add-slide">Add Slide</button>
            <button id="export-presentation" class="secondary">Export Presentation</button>
        </div>
        
        <div class="slide-container" id="slides-container">
            <div class="empty-state" id="empty-state">
                <p>No slides added yet. Click "Add Slide" to get started.</p>
            </div>
            <!-- Slides will be added here dynamically -->
        </div>
    </div>

    <div class="export-modal hidden" id="export-modal">
        <div class="export-content">
            <h2>Export Presentation</h2>
            <div class="export-options">
                <div class="form-group">
                    <label for="export-filename">Filename</label>
                    <input type="text" id="export-filename" value="presentation.json">
                </div>
                <div class="form-group">
                    <label>Export Format</label>
                    <select id="export-format">
                        <option value="json">JSON</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Preview</label>
                    <textarea id="export-preview" readonly rows="10"></textarea>
                </div>
            </div>
            <div class="export-buttons">
                <button id="cancel-export" class="secondary">Cancel</button>
                <button id="download-export">Download</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM elements
            const slidesContainer = document.getElementById('slides-container');
            const emptyState = document.getElementById('empty-state');
            const addSlideBtn = document.getElementById('add-slide');
            const exportBtn = document.getElementById('export-presentation');
            const exportModal = document.getElementById('export-modal');
            const cancelExportBtn = document.getElementById('cancel-export');
            const downloadExportBtn = document.getElementById('download-export');
            const exportPreview = document.getElementById('export-preview');
            const exportFilename = document.getElementById('export-filename');

            // Presentation data
            let presentation = {
                slides: [],
                version: "1.0",
                created: new Date().toISOString()
            };

            // Add a new slide
            addSlideBtn.addEventListener('click', () => {
                const slideId = Date.now();
                const slideNumber = presentation.slides.length + 1;
                
                const slide = {
                    id: slideId,
                    media: '',
                    mediaType: '',
                    caption: '',
                    audio: '',
                    pointerPath: [],
                    originalFilename: '' // Add this line to store original filename
                };
                
                presentation.slides.push(slide);
                renderSlide(slide, slideNumber);
                updateEmptyState();
            });

            // Render a slide
            function renderSlide(slide, number) {
                const slideElement = document.createElement('div');
                slideElement.className = 'slide';
                slideElement.dataset.id = slide.id;
                
                slideElement.innerHTML = `
                    <div class="slide-header">
                        <div class="slide-title">Slide ${number}</div>
                        <div class="slide-controls">
                            <span class="drag-handle">≡</span>
                            <button class="remove-slide danger" data-id="${slide.id}">Remove</button>
                        </div>
                    </div>
                    <div class="slide-content">
                        <div class="media-section">
                            <div class="media-preview" id="preview-${slide.id}">
                                <p>No media selected</p>
                            </div>
                            <div class="media-upload">
                                <div class="form-group">
                                    <label for="media-upload-${slide.id}">Media File</label>
                                    <input type="file" id="media-upload-${slide.id}" accept="image/*,video/*">
                                </div>
                            </div>
                        </div>
                        <div class="details-section">
                            <div class="form-group">
                                <label for="caption-${slide.id}">Caption</label>
                                <textarea id="caption-${slide.id}" placeholder="Enter slide caption...">${slide.caption || ''}</textarea>
                            </div>
                            <div class="pointer-path-editor">
                                <label>Pointer Path</label>
                                <div class="path-points" id="path-points-${slide.id}">
                                    ${slide.pointerPath.length === 0 ? '<p>No path points added</p>' : 
                                        slide.pointerPath.map((point, i) => `
                                            <div class="path-point" data-index="${i}">
                                                <span>Point ${i + 1}:</span>
                                                <input type="number" class="x-coord" value="${point.x}" min="0" max="100" step="0.1" placeholder="X">
                                                <input type="number" class="y-coord" value="${point.y}" min="0" max="100" step="0.1" placeholder="Y">
                                                <input type="number" class="wait-time" value="${point.wait}" min="0" step="100" placeholder="Wait (ms)">
                                                <button class="remove-point danger" data-index="${i}">×</button>
                                            </div>
                                        `).join('')}
                                </div>
                                <button class="add-point" data-id="${slide.id}">Add Point</button>
                            </div>
                        </div>
                    </div>
                `;
                
                slidesContainer.appendChild(slideElement);
                
                // Set up event listeners for this slide
                setupSlideEventListeners(slide.id);
            }

            // Set up event listeners for a slide
            function setupSlideEventListeners(slideId) {
                const slideIndex = presentation.slides.findIndex(s => s.id === slideId);
                if (slideIndex === -1) return;
                
                const slide = presentation.slides[slideIndex];
                const slideElement = document.querySelector(`.slide[data-id="${slideId}"]`);
                
                // Media upload
                const mediaInput = slideElement.querySelector(`#media-upload-${slideId}`);
                mediaInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Store both the original filename and blob URL
                    slide.originalFilename = file.name;
                    slide.mediaType = file.type.startsWith('image') ? 'image' : 'video';
                    slide.media = URL.createObjectURL(file);
                    
                    // Update preview
                    const preview = slideElement.querySelector(`#preview-${slideId}`);
                    preview.innerHTML = '';
                    
                    const mediaElement = document.createElement(slide.mediaType === 'image' ? 'img' : 'video');
                    mediaElement.src = slide.media;
                    if (slide.mediaType === 'video') {
                        mediaElement.controls = true;
                    }
                    
                    preview.appendChild(mediaElement);
                });
                
                // Caption
                const captionInput = slideElement.querySelector(`#caption-${slideId}`);
                captionInput.addEventListener('input', (e) => {
                    slide.caption = e.target.value;
                });
                
                // Add path point
                const addPointBtn = slideElement.querySelector('.add-point');
                addPointBtn.addEventListener('click', () => {
                    slide.pointerPath.push({
                        x: 50,
                        y: 50,
                        wait: 1000
                    });
                    renderPointerPath(slideId);
                });
                
                // Remove slide
                const removeSlideBtn = slideElement.querySelector('.remove-slide');
                removeSlideBtn.addEventListener('click', () => {
                    presentation.slides = presentation.slides.filter(s => s.id !== slideId);
                    slideElement.remove();
                    updateEmptyState();
                });
                
                // Render initial pointer path if it exists
                if (slide.pointerPath.length > 0) {
                    renderPointerPath(slideId);
                }
            }

            // Render pointer path controls
            function renderPointerPath(slideId) {
                const slideIndex = presentation.slides.findIndex(s => s.id === slideId);
                if (slideIndex === -1) return;
                
                const slide = presentation.slides[slideIndex];
                const pathPointsContainer = document.querySelector(`#path-points-${slideId}`);
                
                pathPointsContainer.innerHTML = slide.pointerPath.length === 0 ? 
                    '<p>No path points added</p>' : 
                    slide.pointerPath.map((point, i) => `
                        <div class="path-point" data-index="${i}">
                            <span>Point ${i + 1}:</span>
                            <input type="number" class="x-coord" value="${point.x}" min="0" max="100" step="0.1" placeholder="X">
                            <input type="number" class="y-coord" value="${point.y}" min="0" max="100" step="0.1" placeholder="Y">
                            <input type="number" class="wait-time" value="${point.wait}" min="0" step="100" placeholder="Wait (ms)">
                            <button class="remove-point danger" data-index="${i}">×</button>
                        </div>
                    `).join('');
                
                // Add event listeners for path points
                document.querySelectorAll(`#path-points-${slideId} .path-point`).forEach(pointElement => {
                    const index = parseInt(pointElement.dataset.index);
                    
                    // Update X coordinate
                    pointElement.querySelector('.x-coord').addEventListener('change', (e) => {
                        slide.pointerPath[index].x = parseFloat(e.target.value);
                    });
                    
                    // Update Y coordinate
                    pointElement.querySelector('.y-coord').addEventListener('change', (e) => {
                        slide.pointerPath[index].y = parseFloat(e.target.value);
                    });
                    
                    // Update wait time
                    pointElement.querySelector('.wait-time').addEventListener('change', (e) => {
                        slide.pointerPath[index].wait = parseInt(e.target.value);
                    });
                    
                    // Remove point
                    pointElement.querySelector('.remove-point').addEventListener('click', () => {
                        slide.pointerPath.splice(index, 1);
                        renderPointerPath(slideId);
                    });
                });
            }

            // Update empty state visibility
            function updateEmptyState() {
                emptyState.classList.toggle('hidden', presentation.slides.length > 0);
            }

            // Export presentation - MODIFIED TO USE ORIGINAL FILENAMES
            exportBtn.addEventListener('click', () => {
                const exportData = {
                    slides: presentation.slides.map(slide => ({
                        media: slide.originalFilename, // Use original filename here
                        mediaType: slide.mediaType,
                        audio: slide.audio,
                        caption: slide.caption,
                        pointerPath: slide.pointerPath
                    })),
                    version: "1.0",
                    created: new Date().toISOString()
                };
                exportPreview.value = JSON.stringify(exportData, null, 2);
                exportModal.classList.remove('hidden');
            });

            // Cancel export
            cancelExportBtn.addEventListener('click', () => {
                exportModal.classList.add('hidden');
            });

            // Download export - MODIFIED TO USE ORIGINAL FILENAMES
            downloadExportBtn.addEventListener('click', () => {
                const filename = exportFilename.value || 'presentation.json';
                const exportData = {
                    slides: presentation.slides.map(slide => ({
                        media: slide.originalFilename, // Use original filename here
                        mediaType: slide.mediaType,
                        audio: slide.audio,
                        caption: slide.caption,
                        pointerPath: slide.pointerPath
                    })),
                    version: "1.0",
                    created: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                exportModal.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
